# Name: AttackerKB

TryHackMe [link](https://tryhackme.com/room/attackerkb)
```bash
export IP=10.10.235.213
```
### Task 1 is just an intro, let's head on to Task 2.
I should warn You here that this writeup contains answers to questions (except Source room). If You're looking for nudges go find another writeup. Consider Yourself warned!
### Task 2:

First we need to deploy the machine by clicking the 'Deploy' button.

##### Scan the machine with Nmap. What non-standard service can be found running the high port?

Scanning the machine is simple, I use my standard set of nmap commands:
```bash
sudo nmap -sC -sV -A -T4 -p- -v -oN scans/nmap.initial $IP

```
command    |result
-----------|----------
sudo       |run as root
sC         |run default scripts
sV         |enumerate versions
A          |aggressive mode
T4         |run a bit faster
p-         |scan all ports
v          |verbose scan (print results while scanning)
oN         |output to file with nmap formatting
scans/*    |direct output to my subfolder

There seems to be only two services running, so the answer is obvious:
port      |service
----------|----------
22        |SSH
10000     |MiniServ

###### Answer:
```
Webmin
```
##### Further enumerate the service, what version of it is running?

We already run a version scan before so we've got the answer:
```
1.890
```
##### Visit the webpage generated by this service. You should encounter an error due to SSL being present. Change the URL to use HTTPS and ignore the exception. After this, view the certificate. What hostname can we find on the cert details?

The question here explains what is needed to be done. Go ahead and navigate to the page, to find:
###### Answer:
```
source
```
Don't forget to add port number to the address of the page!


Firefox tutorial:

First let's go to the page:

![Page view](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Address.png)

If the address is correct, then we should see something like this:

![Page view](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Page1.png)

After clicking Advanced... -> Accept the Risk and Continue we finally land on what seems a real login page:

![Login page](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Page2.png)

Ok, now it's time to search for the host name, so we proceed by clicking the i button in address bar:

![Address bar](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Address.png)

Moving on, we click the right arrow on the connection tab:

![Menu](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Menu.png)

Next we click the `More information` button on the bottom:

![Menu](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Menu_next.png)

This is the security tab, which will lead us to the certificate:

![Security](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Cert.png)

What we see now is the information about page's security certificate, its issuer and who is it issued to. What is standing out is the name `source`, so I assume it's our hostname. We can see it here:

![Source](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Source1.png)

and here:

![Source](https://github.com/malakx/TryHackMe/blob/master/AttackerKB/images/Source2.png)


### Task 3:

##### Take a look through the Assessments for this vulnerability. As an attacker, we can use the information posted here by other members to determine how value an exploit might be and any tweaks we might have to make to exploit code. Similarly, as a defender we can leverage these comments to gain additional situational information for vulnerabilities, allowing us to gauge how quickly we need to patch them. Which version of Webmin is immediately vulnerable to this exploit?

Once redirected to the AttackerKB site do all the things according to author. On the page with vulnerability, there is a kind of message board, and one user `wvu-r7` says `Version 1.890 is the money. Anything after requires a non-default setting.`
###### Answer:
```
1.890
```
##### What type of attack was this? Note, we're looking for how this was added to the code for Webmin, not how this results in remote code execution (RCE).
Reading through the same post of forementioned author we find out that the answer is:
```
supply chain
```
##### Can you find a link to a post on the webmin's website explaining what happened? What day was Webmin informed of an 0day exploit?
The post mentioned before gives us link to webmin page with the exploit data written down. Reading through the article we find the answer:
```
August 17th 2019
```
##### Last but certainly not least, let's find the link to our exploit. We can see in the Assessments that a Metasploit module was added for this backdoor. What pull number was this added in?
Just hovering a mouse over the link to metasploit module in the post mentioned before gives us information we need:
```
12219
```
### Task 4:
To launch metasploit simply type `msfconsole` in Your terminal window. To search for modules use `search` command. In my case using `search webmin` command gave 6 results. One we're going after is `exploit/linux/http/webmin_backdoor`. To use this module type `use exploit/linux/http/webmin_backdoor`.

To see what we can modify type `options`. 
##### Now that we've selected our exploit, set the options provided appropriately. Beyond RHOSTS and LHOST, what is the third option we must set to 'True'?
Remember we had to navigate to https:// in order to run the webmin page? Well, that's SSL connection, so we need to set this to true in order to navigate the metasploit module correctly. Without this setting it would navigate to http:// and the exploit would fail: `set SSL true`
###### Answer:
```
SSL
```
##### Run the exploit. What is the user flag?
To run the exploit You must have set the correct RHOST - target ip, and LHOST - Your ip (to see Your ip on linux type `ip addr show tun0`). After setting up the module use `run` or `exploit` command to  get shell. We run as super user so there is nothing more to elevate, just read the mentioned files.
###### Answer:
```
THM{*REDACTED*}
```
##### How about the root flag?
```
THM{*REDACTED*}
```
Congratulations! You have just completed two machines at once! AttackerKB and [Source](https://tryhackme.com/room/source)!

Thanks for reading this writeup, hope You've learned something new!
